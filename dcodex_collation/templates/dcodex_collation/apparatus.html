{% extends "base.html" %}
{% load dcodex_tags %}
{% load dcodex_collation_tags %}
{% block title %}Apparatus {{alignment.verse}} ({{ alignment.family }}){% endblock %}

{% block content %}
<div class="container">
    {% if alignment.prev_in_order %}
    <a href="{% url 'apparatus' family_siglum=alignment.prev_in_order.family.name verse_ref=alignment.prev_in_order.verse.url_ref %}" class="btn btn-outline-primary btn-sm chk-saved" data-toggle="tooltip" data-placement="bottom" title="{{ alignment.prev_in_order }}">
            <i class="fas fa-arrow-left"></i>
        </a>
    {% endif %}
    <a href="{{ alignment.get_absolute_url }}" class="btn btn-outline-primary btn-sm chk-saved" data-toggle="tooltip" data-placement="bottom" title="{{ alignment }} Table">
        <i class="fa fa-table"></i>
    </a>
    {% if alignment.next_in_order %}
        <a href="{% url 'apparatus' family_siglum=alignment.next_in_order.family.name verse_ref=alignment.next_in_order.verse.url_ref %}" class="btn btn-outline-primary btn-sm chk-saved" data-toggle="tooltip" data-placement="bottom" title="{{ alignment.next_in_order }}">
            <i class="fas fa-arrow-right"></i>
        </a>
    {% endif %}

    <table class="table">
        <tbody>
            <tr><td>Family</td><td>{{ alignment.family }}</td></tr>
            <tr><td>Verse</td><td><a href='{{ alignment.get_absolute_url }}'>{{ alignment.verse }}</a></td></tr>
        </tbody>
    </table>
    
    <h2>Apparatus</h2>
    <p style='font-size: 1.5em;'>{{ alignment.verse }}
    {% for atext_column_data in atext_data %}
        <a href='{{ atext_column_data.column.get_absolute_url }}'><span style='color: {% if atext_column_data.is_majority %}grey{%else%}black{%endif%}'>{% if atext_column_data.state.text %}{{ atext_column_data.state }}{% else %}⸆{% endif %}</a>
    {% endfor %}
    </p>
    <p>
    <ul>
    {% for atext_column_data in atext_data %}
        {% if atext_column_data.alternatives %}
            <li>
            
            <b>{% if atext_column_data.state.text %}{{ atext_column_data.state }}{% else %}⸆{% endif %}]</b>
            {% for state in atext_column_data.alternatives %}
                {% if state.text %}{{ state }}{% else %}OMIT{% endif %} {% sigla_with_state column=atext_column_data.column state=state %}{% if forloop.last %}.{%else%} | {%endif%}
            {% endfor %}
            </li>
        {% endif %}
    {% endfor %}
    </ul>
    </p>
    <p><b>Witnesses:</b> 
    {% for row in alignment.row_set.all %}
        <a href="{% url 'dcodex-manuscript-verse' request_siglum=row.transcription.manuscript.siglum request_verse=alignment.verse.url_ref %}">{{row.transcription.manuscript.short_name}}</a>{% if forloop.last %}.{%else%},{%endif%}
    {% endfor %}
    </p>

    <p><b>Missing:</b>    
    {% for manuscript in alignment.untranscribed_manuscripts %}
        <a href="{% url 'dcodex-manuscript-verse' request_siglum=manuscript.siglum request_verse=alignment.verse.url_ref %}">{{manuscript.short_name}}</a>{% if forloop.last %}.{%else%},{%endif%}
    {% endfor %}
    </p>

</div>



{% endblock content %}


